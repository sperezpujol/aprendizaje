---
title: "Trabajo de Text Mining | Proyecto <p> Text Mining aplicado a una novela de Charles Dickens"
subtitle: "Máster Universitario en Modelización y Análisis de Datos Económicos <p> (MUMADE)"
author: 'Autores: Bermann, M.A. & Pérez, R.S. [Grupo D]'
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
    prettydoc::html_pretty:
    theme: cayman
    highlight: vignette
lang: es
---

```{r setup, include = FALSE}
# Ajustes de los chunk
knitr::opts_chunk$set(echo = FALSE, 
                      eval = TRUE, 
                      message = FALSE,
                      warning = FALSE,
                      comment = '')
```

```{r inicio, include = FALSE}
# Limpieza inicial del entorno
rm(list = ls())

# Instalación de paquetes que no estén instalados
packages <- c("tidyr",
              "dplyr",
              "tidytext",
              "tidyverse",
              "gutenbergr",
              "tokenizers",
              "tm",
              "ggplot2",
              "igraph",
              "ggraph",
              "scales",
              "stringr")

installed_packages <- packages %in% 
  rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Activación de paquetes
library(tidyr)
library(dplyr)
library(tidytext)
library(tidyverse)
library(gutenbergr)
library(tokenizers)
library(tm)
library(ggplot2)
library(igraph)
library(ggraph)
library(scales)
library(stringr)
```

# Resumen 

Párrafo único

# Procesamiento del texto

En primer lugar se ha **descargado e importado** al entorno de trabajo la novela, a través del [Project Gutenberg](https://www.gutenberg.org/ebooks/730), donde _Oliver Twist_ tiene la numeración [730](https://www.gutenberg.org/files/730/730-0.txt).

```{r importacion, include = FALSE}
# Importando la obra del Proyecto Gutenberg
olivertwist <- 
  gutenberg_download(c(730))

# Ajustándonos al principio y final de la novela y otros ajustes
text_olivertwist <-
  olivertwist %>% 
  slice((114:18813)) %>% 
  select(2) %>% 
  pull() %>%
  map(trimws) %>%
  ifelse(. == "", "_salto_", .) %>%
  paste0(., collapse = " ") %>%
  strsplit(split = "_salto_") %>%
  map(trimws) %>%
  data.frame(stringsAsFactors = FALSE) %>%
  as_tibble() %>%
  {
    names(.) <- "texto"
    .
  }

# Eliminando filas en blanco finales
text_olivertwist <-
  text_olivertwist %>% 
  slice((1:3894))

# Quitando renglones vacíos
text_olivertwist <-
  text_olivertwist %>%
  filter(!texto %in% c(" ", "")) %>%
  mutate_all(trimws)

# Agrupando párrafos por capítulos
text_olivertwist %>%
  filter(grepl("CHAPTER",
               texto))

text_olivertwist <-
  text_olivertwist %>%
  mutate(capitulo = ifelse(grepl("CHAPTER", 
                                 texto), 
                           texto, NA)) %>%
  fill(capitulo) %>%
  filter(texto != capitulo)

# Tokenizando
tidy_olivertwist <- 
  text_olivertwist %>%
  unnest_tokens(word, texto) %>%
  anti_join(stop_words)

# Palabras más frecuentes
tidy_olivertwist %>%
  count(word,
        sort = TRUE)

frequency <- mutate(tidy_olivertwist,
                    author = "Charles Dickens") %>%
  mutate(word = str_extract(word,
                            "[a-z']+")) %>%
  count(author, word) %>%
  group_by(author) %>%
  mutate(proportion = n / sum(n)) %>%
  select(-n) %>%
  spread(author, proportion) %>%
```

# Análisis de sentimientos

# Nube de palabras

# Frecuencia de palabras

# Conclusiones

Párrafo 1

Párrafo 2

# Referencias

En esta sección se incluyen las referencias bibliográficas utilizadas para el desarrollo del proyecto.

[Dickens, C. (1837). Oliver Twist. Project Gutenberg. https://www.gutenberg.org/ebooks/730.](https://www.gutenberg.org/ebooks/730)

Gutiérrez, M.J. (2022). Text mining con R. Aprendizaje estadístico y otras técnicas avanzadas. Máster Universitario en Modelización y Análisis de Datos Económicos. Universidad de Castilla-La Mancha.

[El Cronovisor (2017). Charles Dickens, genio de la crítica social. Episodio 4. https://open.spotify.com/episode/3lLBJHZGY3verRFV6ptEbS?si=9_xGOeGWTiW4ijZuIexBeg&utm_source=copy-link](https://open.spotify.com/episode/3lLBJHZGY3verRFV6ptEbS?si=9_xGOeGWTiW4ijZuIexBeg&utm_source=copy-link)

[Silge, J. & Robinson D. (2022). Text Mining with R. https://www.tidytextmining.com/tidytext.html.](https://www.tidytextmining.com/tidytext.html)

# Anexos

## Anexo 1. Datos de la sesión

En esta sección se recogen los datos de la sesión utilizada para elaborar este informe. Es fundamental observar la versión de R, así como las versiones de los paquetes bajo los cuales se ha ejecutado el código o *script*.

```{r}
sessionInfo()
```
